<?xml version="1.0"?>
<!-- NANT Build file -->
<project name="Win32-CommandLine" default="build">
	<target name="*" depends="build"/><!-- BUILD if target not recognized -->

    <property name="bin.dir" value="c:\users\public\documents\@bin"/>

    <target name="build">
        <nant buildfile="../.build" />
        <!-- NOT NEEDED (done in parent build): exec program="perl.exe" commandline="Build.PL" if="${ not file::exists('_build\lib\RIVY\Builder.pm') or not file::up-to-date('Build.PL','_build\lib\RIVY\Builder.pm') }" /-->

	    <property name="bat.source.dir" value="..\..\bat\advanced"/>
		<fileset id="bat.source.files" defaultexcludes="false" basedir="${bat.source.dir}">
			<include name="so.bat" />
		</fileset>

		<foreach item="File" property="name">
			<in><items refid="bat.source.files"/></in>
			<do>
				<!-- CONFIG -->
				<property name="source.dir" value="${bat.source.dir}"/>
				<property name="destination.dir" value="extras"/>
				<!-- ====== -->
				<property name="fname" value="${string::substring(name,string::get-length(path::get-full-path(source.dir))+1,string::get-length(name)-string::get-length(path::get-full-path(source.dir))-1)}"/>
				<property name="s.fname" value="${source.dir}/${fname}"/>
				<property name="d.fname" value="${destination.dir}/${fname}"/>
				<property name="s.isNewer" value="${not file::exists(d.fname) or (file::get-last-write-time(s.fname) > file::get-last-write-time(d.fname))}" />
				<property name="d.isNewer" value="${file::exists(d.fname) and (file::get-last-write-time(d.fname) > file::get-last-write-time(s.fname))}"/>
				<echo message="source.dir = ${source.dir}; destination.dir = ${destination.dir}; fname = ${fname}; s.fname = ${s.fname}; d.fname = ${d.fname}" />
				<if test="${d.isNewer}">
					<echo level="Warning" message="WARNING: In directory '${path::get-file-name(destination.dir)}', '${path::get-file-name(d.fname)}' is NEWER than the SOURCE file (NOT OVERWRITTEN)."/>
				</if>
				<if test="${not d.isNewer}">
					<copy file="${name}" tofile="${destination.dir}/${fname}"/>
					<attrib readonly="true" file="${destination.dir}/${fname}"/>
				</if>
			</do>
		</foreach>

	    <property name="eg.source.dir" value="eg"/>
		<fileset id="eg.source.files" defaultexcludes="false" basedir="${eg.source.dir}">
			<include name="to.bat" />
		</fileset>

		<foreach item="File" property="name">
			<in><items refid="eg.source.files"/></in>
			<do>
				<!-- CONFIG -->
				<property name="source.dir" value="${eg.source.dir}"/>
				<property name="destination.dir" value="${bin.dir}"/>
				<!-- ====== -->
				<property name="fname" value="${string::substring(name,string::get-length(path::get-full-path(source.dir))+1,string::get-length(name)-string::get-length(path::get-full-path(source.dir))-1)}"/>
				<property name="s.fname" value="${source.dir}/${fname}"/>
				<property name="d.fname" value="${destination.dir}/${fname}"/>
				<property name="s.isNewer" value="${not file::exists(d.fname) or (file::get-last-write-time(s.fname) > file::get-last-write-time(d.fname))}" />
				<property name="d.isNewer" value="${file::exists(d.fname) and (file::get-last-write-time(d.fname) > file::get-last-write-time(s.fname))}"/>
				<echo message="source.dir = ${source.dir}; destination.dir = ${destination.dir}; fname = ${fname}; s.fname = ${s.fname}; d.fname = ${d.fname}" />
				<if test="${d.isNewer}">
					<echo level="Warning" message="WARNING: In directory '${path::get-file-name(destination.dir)}', '${path::get-file-name(d.fname)}' is NEWER than the SOURCE file (NOT OVERWRITTEN)."/>
				</if>
				<if test="${not d.isNewer}">
					<copy file="${name}" tofile="${destination.dir}/${fname}"/>
					<attrib readonly="true" file="${destination.dir}/${fname}"/>
				</if>
			</do>
		</foreach>

	    <property name="extras.source.dir" value="extras"/>
		<fileset id="extras.source.files" defaultexcludes="false" basedir="${extras.source.dir}">
			<include name="dosify.bat" />
			<include name="so.bat" />
			<include name="quote.bat" />
			<include name="which.pl" />
		</fileset>

		<foreach item="File" property="name">
			<in><items refid="extras.source.files"/></in>
			<do>
				<!-- CONFIG -->
				<property name="source.dir" value="${extras.source.dir}"/>
				<property name="destination.dir" value="${bin.dir}"/>
				<!-- ====== -->
				<property name="fname" value="${string::substring(name,string::get-length(path::get-full-path(source.dir))+1,string::get-length(name)-string::get-length(path::get-full-path(source.dir))-1)}"/>
				<property name="s.fname" value="${source.dir}/${fname}"/>
				<property name="d.fname" value="${destination.dir}/${fname}"/>
				<property name="s.isNewer" value="${not file::exists(d.fname) or (file::get-last-write-time(s.fname) > file::get-last-write-time(d.fname))}" />
				<property name="d.isNewer" value="${file::exists(d.fname) and (file::get-last-write-time(d.fname) > file::get-last-write-time(s.fname))}"/>
				<echo message="source.dir = ${source.dir}; destination.dir = ${destination.dir}; fname = ${fname}; s.fname = ${s.fname}; d.fname = ${d.fname}" />
				<if test="${d.isNewer}">
					<echo level="Warning" message="WARNING: In directory '${path::get-file-name(destination.dir)}', '${path::get-file-name(d.fname)}' is NEWER than the SOURCE file (NOT OVERWRITTEN)."/>
				</if>
				<if test="${not d.isNewer}">
					<copy file="${name}" tofile="${destination.dir}/${fname}"/>
					<attrib readonly="true" file="${destination.dir}/${fname}"/>
				</if>
			</do>
		</foreach>

    </target>

    <target name="install" />

</project>
